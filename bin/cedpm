#!/bin/bash

SCRIPT_PATH="$(realpath "$0")"
SCRIPT_ROOT="$(dirname "$SCRIPT_PATH")"
ENV_FILE=$SCRIPT_ROOT/env.sh

if ! ls  $ENV_FILE &>/dev/null; then
	chmod +x $SCRIPT_ROOT/cedpm_setup.sh
	$SCRIPT_ROOT/cedpm_setup.sh
	chmod +x $ENV_FILE
	source $ENV_FILE
fi;

source $ENV_FILE

show_help() {
cat << EOF
CEDPM - Cedilla's Package Manager v0.0

USAGE:
    cedpm [COMMAND] [ARGUMENTS]

COMMANDS:
    build                     Build all targets
    install                   Install all backages
    install [package_name]    Install a new package
    remove [package_name]     Remove an existing package
    update [package_name]     Update a specific package
    update                    Update all packages
    list                      List installed packages
    search [packgae_name]     Search a package online
    help                      Show this help message

EXAMPLES:
    cedpm install nginx       Install the nginx package
    cedpm remove nginx        Remove the nginx package
    cedpm update nginx        Update nginx package
    cedpm upgrade             Update all installed packages
    cedpm list                List all installed packages
    cedpm eval Hello.pkl      Test a PKL file

For more information, visit: https://cedpm.com
EOF
}

if [ $# -eq 0 ]; then
    show_help
    exit 1
fi

# Main switch-case to handle commands
case "$1" in
	info)
		source $SCRIPT_ROOT/cedpm_info.sh
		;;
	build)
		source $SCRIPT_ROOT/cedpm_build.sh
		;;
	eval)
		shift;
		source $SCRIPT_ROOT/cedpm_eval.sh "$@"
		;;
    install)
		$SCRIPT_ROOT/cedpm_install.sh "$@"
        ;;
    remove)
        echo "Removing package: ${2}"
        ;;
    update)
        echo "Updating package: ${2}"
        ;;
    upgrade)
        echo "Upgrading all packages"
        ;;
    list)
        echo "Listing installed packages"
        ;;
    help)
        show_help
        ;;
    *)
        echo "Unknown command: $1"
        show_help
        ;;
esac
